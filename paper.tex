%!TEX TS-program = xelatex
\documentclass{article}
\usepackage{mathtools}
\usepackage{unicode-math}
\usepackage{physics}
\begin{document}

\section{Why A CompoundPrism Spectrometer}\label{sec:why-a-compoundprism-spectrometer}
wavelength dependent n => good dispersion and linearity
good transmission for both s and p polarization
good for straight line optics / can minimize deviation

Composed of Trapezoidal prisms and/or if the extension length, ${\ell_i }$ is 0, then Triangular prisms

The last prism is the union of a Trapezoidal prism and a Horizontal Cylindrical Segment, as the exit
face of the prism

\section{System Parametrization}\label{sec:system-parametrization}
\begin{itemize}
\item $N$ = prism count
\item ${\theta_1, \dots \theta_N }$ =  angle of deviation from x-axis for each inter-media planar prism surface
\item $\theta_c$ =  angle of deviation from x-axis for the chord of the lens-like inter-media prism surface
\item ${\ell_1, \dots \ell_N }$ = extension length for each prism
\item $h$ = prism height
\item $\ell_z$  = prism width
\item $\ell_a$  = detector array length
\item $\vec{p}_a$ = detector array position vector
\item $\hat{v}_a$ = detector array direction unit vector
\item $\hat{n}_a$ = detector array normal unit vector
\item $\mu_b$ = mean beam position on y-axis
\item $w_b = 1 / e^2$ {beam width}
\item $D$ = set of detection bins composing the detector array
\item $\forall d \in D, [lb_d, ub_d) \equiv$ bounds of the detection bin, $d$
\begin{itemize}
\item[\textasteriskcentered] $0 \leq lb_1 < ub_1 \leq lb_2 < ... < ub_{|D|} \leq \ell_a $
\end{itemize}
\item $\Lambda \sim \mathcal{U}(\lambda_{min}, \lambda_{max}) $
\item $Y \sim \mathcal {N}(\mu=\mu_b, \sigma^2=(\frac{1}{2}w_b)^2) \subseteq [0, h] $
\item $Z \sim \mathcal {N}(\mu=0, \sigma^2=(\frac{1}{2}w_b)^2) \subseteq [-\ell_z / 2, \ell_z / 2]$
\end{itemize}
\section{Ray Propagation}\label{sec:ray-propagation}
$\hat{n}_i = R(\theta_i) \cdot -\hat{x}$ = normal unit vector for planar inter-media surface $i$

$\vec{p}_{0, i}$ = mid-point vector for planar inter-media surface $i$

$\hat{n}_c = R(\theta_c) \cdot -\hat{x}$ = normal unit vector for the chord of the lens inter-media surface

$\vec{p}_{0, c}$ = mid-point vector for the chord of the lens inter-media surface


\subsection{Refraction}\label{subsec:refraction}
$\hat{n}$ = inter-media surface normal vector towards current media

$\hat{l}$ = light ray direction unit vector

$n_1$ = index of refraction of current media

$n_2$ = index of refraction of next media

$r = n_1 / n_2$

$c_i = -\hat{n} \cdot{} \hat{l} = \cos{\theta_i}$

if $r^2 (1 - c_i^2) > 1 \to$ fail to refract due to total internal reflection

$c_t = \sqrt{1 - r^2 (1 - c_i^2)} = \cos{\theta_t}$

$\hat{v}_{\text{refract}} = r \hat{l} + (r c_i - c_t) \hat{n}$

$T_{s} = 1 - | \frac{n_1 c_i - n_2 c_t}{n_1 c_i + n_2 c_t} |^2$

$T_{p} = 1 - | \frac{n_1 c_t - n_2 c_i}{n_1 c_t + n_2 c_i} |^2$

\subsection{Ray-Plane Intersection}\label{subsec:ray-plane-intersection}
$\hat{l}$ = light ray direction unit vector

$\vec{o}$ = origin of the light ray

$\hat{n}$ = normal unit vector of the plane towards $\vec{o}$

$\vec{p}_0$ = point on the plane

if $\hat{l} \cdot \hat{n} = 0 \to $ No intersection between the ray and plane

$d = \frac{(\vec{p}_0 - \vec{o}) \cdot \hat{n}}{\hat{l} \cdot \hat{n}}$ = distance between the ray's origin and the point of intersection

$\vec{p} = \vec{o} + d\hat{l}$ = point of intersection

\subsection{Ray-Arc Intersection}\label{subsec:ray-arc-intersection}
\subsubsection{Circular Arc Parametrization}
k = normalized curvature

$\vec{p}_0$ = mid-point of the chord

$\hat{n}$ = normal unit vector of the chord towards the center

$\ell_c$ = chord length

$\kappa = k / (\frac{1}{2} \ell_c)$ = curvature

$r = \frac{1}{\kappa}$ = radius

$a = \sqrt{r^2 - (\frac{1}{2}\ell_c)^2}$ = apothem

$s = r - a$ = sagitta

$\vec{c} = \vec{p}_0 + a \hat{n}$ = center

$\vec{p}_1 = \vec{p}_0 - s \hat{n}$ = mid-point of the arc

\subsubsection{Ray Intersection}
$\hat{l}$ = light ray direction unit vector

$\vec{o}$ = origin of the light ray

if $((\vec{l} \cdot (\vec{o} - \vec{c}))^2 - (||\vec{o} - \vec{c}||^2 - r^2)) \leq 0 \to $ No intersection between the ray and circle

$d = -(\vec{l} \cdot (\vec{o} - \vec{c})) + \sqrt{(\vec{l} \cdot (\vec{o} - \vec{c}))^2 - (||\vec{o} - \vec{c}||^2 - r^2)}$
= distance between the ray's origin and the furthermost point of intersection on the circle

$\vec{p} = \vec{o} + d\hat{l}$ = point of intersection

if $||\vec{p} - \vec{p}_1||^2 > (s^2 + (\frac{1}{2}\ell_c)^2) \to $ No intersection between the ray and arc

\subsection{Parametrization \& Propagation details}\label{subsec:parametrization&propagation-details}
$\hat{l}_0 = \hat{x}$ = incoming light ray direction unit vector

$y_0$ = initial y-axis position of the incoming light ray

$\vec{o}_0 = y_0\hat{y}$ = origin of the incoming light ray

$n_0 = n_f = 1$ = index of refraction of air outside the compound prism

\[\hat{v}_{\text{refract}, i} = \begin{cases}
		f_{\text{refract}}(\hat{l}=\hat{l}_i, \hat{n}=\hat{n}_{i+1}, n_1=n_i, n_2=n_{i+1})                                   & 0 \le i < N \\
		f_{\text{refract}}(\hat{l}=\hat{l}_i, \hat{n}=\frac{\vec{c} - \vec{p}_i}{||\vec{c} - \vec{p}_i||}, n_1=n_i, n_2=n_f) & i = N       \\
	\end{cases}\]

$\hat{l}_i = \hat{v}_{\text{refract}, i - 1}$

\[\vec{p}_i = \begin{cases}
		f_{\text{ray-plane intersection}}(\hat{l}=\hat{l}_i, \vec{o}=\vec{o}_i, \hat{n}=\hat{n}_{i+1}, \vec{p}_0=\vec{p}_{0, i+1})                    & 0 \le i < N \\
		f_{\text{ray-arc intersection}}(\hat{l}=\hat{l}_i, \vec{o}=\vec{o}_i, \hat{n}=\hat{n}_c, \vec{p}_0=\vec{p}_{0, c}, \ell_c=h/\cos{\theta_{c}}) & i = N       \\
		f_{\text{ray-plane intersection}}(\hat{l}=\hat{l}_i, \vec{o}=\vec{o}_i, \hat{n}=\hat{n}_{a}, \vec{p}_0=\vec{p}_a)                             & i = N + 1   \\
	\end{cases}\]

if $\exists \vec{p}_{i \le N}, \neg (0 \le \vec{p}_i \cdot \hat{y} \le h) \to$ fail due to the ray leaving the prism

$\vec{o}_i = \vec{p}_{i - 1}$

$\hat{v}_f = \hat{v}_{\text{refract}, N}$

$\vec{p}_f = \vec{p}_{N + 1}$

if $-\hat{v}_f \cdot \hat{n}_a \le \cos{\theta_{\text{max}}} \to$ fail to detect because the spectrometer angular response is too weak

$T_s = \prod_{i=0}^{N + 1} T_{s,i}$

$T_p = \prod_{i=0}^{N + 1} T_{p,i}$

$T = \frac{1}{2} (T_s + T_p)$

if the ray propagation fails at any step $\to T = 0$

\subsection{Propagation results}\label{subsec:propagation-results}
$T(\lambda, y)$ = transmittance probability of a wavelength, $\lambda$, from an initial y, to the intersection with the detector array

$\vec{S}(\lambda, y)$ = position vector of the intersection of the detector array($\vec{p}_f$), and of a wavelength, $\lambda$, from an initial y

\[p(D=d|\Lambda=\lambda \cap Y=y \cap Z=z) = \begin{cases}
		T(\lambda, y) & lb_d <= ((\vec{S}(\lambda, y) - \vec{p}_a) \cdot \hat{v}_a) < ub_d \land -\ell_z / 2 <= z <= \ell_z / 2 \\
		0             & else
	\end{cases}\]

\section{Derivations}\label{sec:derivations}

$\vec{\delta} = \vec{p}_a + \frac{1}{2} \ell_a \hat{v}_a - \mu_b \hat{y}$ = spectrometer footprint vector

$p(D=d|\Lambda=\lambda) = \mathbb{E}_{Y,Z}[p(D=d|\Lambda=\lambda \cap Y=y \cap Z=z)]$

$p(D=d) = \mathbb{E}_{\Lambda}[p(D=d|\Lambda=\lambda)]$

$H(D) = -\sum_{d \in D}p(D=d) log_2[p(D=d)]$

$H(D|\Lambda) = -\sum_{d \in D}\mathbb{E}_{\Lambda}[p(D=d|\Lambda=\lambda)log_2[p(D=d|\Lambda=\lambda)]]$

$I(\Lambda; D) = H(D) - H(D|\Lambda)$

\section{Optimization Objectives}\label{sec:optimization-objectives}

spectrometer size = $||\vec{\delta}||$

spectrometer ray deviation = $| \vec{\delta} \cdot \hat{y} | / ||\vec{\delta}|| = | \sin(\theta_{deviation}) | $

mutual information = $I(\Lambda; D)$

\end{document}
